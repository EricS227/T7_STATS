{% extends "base.html" %}
{% block content %}

<h2>Add New Match</h2>

<form method="POST">
    <div class="form-group">
        <label>Player 1:</label>
        <select name="player1_id" id="player1_id" required onchange="updateWinnerOptions()">
            <option value="">Select Player</option>
            {% for player in players %}
            <option value="{{ player.id }}">{{ player.name }} ({{ player.main_char }})</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Player 1 Character:</label>
        <select name="player1_char" id="player1_char" required>
            <option value="">Select Character</option>
            {% for char in chars %}
            <option value="{{ char }}">{{ char }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Player 2:</label>
        <select name="player2_id" id="player2_id" required onchange="updateWinnerOptions()">
            <option value="">Select Player</option>
            {% for player in players %}
            <option value="{{ player.id }}">{{ player.name }} ({{ player.main_char }})</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Player 2 Character:</label>
        <select name="player2_char" id="player2_char" required>
            <option value="">Select Character</option>
            {% for char in chars %}
            <option value="{{ char }}">{{ char }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Winner:</label>
        <select name="winner_id" id="winner_id" required>
            <option value="">Select Winner</option>
        </select>
    </div>

    <button type="submit">Save Match</button>
</form>

<a href="{{ url_for('index') }}">‚Üê Back to Home</a>

<script>
    function updateWinnerOptions() {
        const p1Select = document.getElementById('player1_id');
        const p2Select = document.getElementById('player2_id');
        const winnerSelect = document.getElementById('winner_id');

        const p1 = p1Select.value;
        const p2 = p2Select.value;
        const p1Text = p1Select.options[p1Select.selectedIndex]?.text || '';
        const p2Text = p2Select.options[p2Select.selectedIndex]?.text || '';

        winnerSelect.innerHTML = '<option value="">Select Winner</option>';

        if (p1) {
            const opt1 = document.createElement('option');
            opt1.value = p1;
            opt1.textContent = p1Text;
            winnerSelect.appendChild(opt1);
        }

        if (p2 && p2 !== p1) {
            const opt2 = document.createElement('option');
            opt2.value = p2;
            opt2.textContent = p2Text;
            winnerSelect.appendChild(opt2);
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', updateWinnerOptions);
</script>

{% endblock %}

    